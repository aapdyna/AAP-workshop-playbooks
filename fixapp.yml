---
- name: Update environment variables and roll out latest deployment on OpenShift
  hosts: all
  connection: ssh
  tasks:
    - name: Login to OpenShift cluster
      command: oc login -u admin -p elelUx1T7XajD9EY https://api.cluster-qhbht.qhbht.sandbox39.opentlc.com:6443
    - name: Set environment variable for deployment config
      command: oc set env dc/easytravel-loadgen ET_PROBLEMS- -n easytravel
    - name: Roll out latest deployment for easytravel-backend
      command: oc rollout latest dc/easytravel-backend -n easytravel
    - name: Roll out latest deployment for easytravel-frontend
      command: oc rollout latest dc/easytravel-frontend -n easytravel

    - name: Notify Slack channel
      slack:
       token: "T0508SWKB2N/B04V8C4P6A3/fr3b7rtyxJrZgjuRqQ1UCT1d"
       channel: "#devops"
       msg: "*Updating Dyntrace to Block source and port of suspicious activity"
